(function(n){"use strict";function i(t,i){function v(){return r.editProxy.data("typeahead")&&r.editProxy.data("typeahead").$menu.is(":visible")}function b(n){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return n.replace(new RegExp("("+t+")","ig"),function(n,t){return"<strong>"+t+"</strong>"})}function k(){function e(){r.isMouseOverTable=!0}function i(){r.isMouseOverTable=!1}function g(){r.isMouseDown=!1,r.fillHandle&&r.fillHandle.isDragged&&(r.fillHandle.isDragged>1&&s.apply(),r.fillHandle.isDragged=0)}function d(){setTimeout(function(){r.isMouseOverTable||f.deselect()},1)}var w,l,b;r.table=n('<table cellspacing="0" cellpadding="0"><tbody></tbody></table>'),r.tableBody=r.table.find("tbody")[0];r.table.on("mousedown","td",c.onMouseDown);r.table.on("mouseover","td",c.onMouseOver);r.table.on("dblclick","td",c.onDblClick);t.append(r.table),w=u.keepEmptyRows(),w||u.createLegend(),h.init(),r.currentBorder=new a(t,{className:"current",bg:!0}),r.settings.fillHandle&&s.init(),o.init();r.table.on("mouseenter",e);r.table.on("mouseleave",i);r.editProxy.on("mouseenter",e);r.editProxy.on("mouseleave",i);if(r.fillHandle){n(r.fillHandle.handle).on("mouseenter",e).on("mouseleave",i);n(r.fillBorder.main).on("mouseenter",e).on("mouseleave",i)}n(r.selectionBorder.main).on("mouseenter",e).on("mouseleave",i);n(r.currentBorder.main).on("mouseenter",e).on("mouseleave",i).on("dblclick",c.onDblClick);n("html").on("mouseup",g);n("html").on("click",d);t[0].tagName.toLowerCase()!=="html"&&t[0].tagName.toLowerCase()!=="body"&&t.css("overflow")==="scroll"?r.scrollable=t:t.parents().each(function(){if(this.tagName.toLowerCase()!=="html"&&this.tagName.toLowerCase()!=="body"&&n(this).css("overflow")=="scroll")return r.scrollable=n(this),!1}),r.scrollable?(r.scrollable.scrollTop(0),r.scrollable.scrollLeft(0)):r.scrollable=n(window);r.scrollable.on("scroll",function(n){n.stopPropagation()});if(r.settings.contextMenu){var k=function(n){var t=u.getCornerCoords([r.selStart,r.selEnd]);switch(n){case"row_above":u.alter("insert_row",t.TL);break;case"row_below":u.alter("insert_row",{row:t.BR.row+1,col:0});break;case"col_left":u.alter("insert_col",t.TL);break;case"col_right":u.alter("insert_col",{row:0,col:t.BR.col+1});break;case"remove_row":case"remove_col":u.alter(n,t.TL,t.BR)}},v=function(t){var i=u.getCornerCoords([r.selStart,r.selEnd]);return((t==="row_above"||t==="remove_row")&&i.TL.row===0||(t==="col_left"||t==="remove_col")&&i.TL.col===0)&&n(u.getCellAtCoords(i.TL)).data("readOnly")?!0:!1},p={row_above:{name:"Insert row above",disabled:v},row_below:{name:"Insert row below"},sep1:"---------",col_left:{name:"Insert column on the left",disabled:v},col_right:{name:"Insert column on the right"},sep2:"---------",remove_row:{name:"Remove row",disabled:v},remove_col:{name:"Remove column",disabled:v}},y;if(r.settings.contextMenu.length)for(y={},l=0,b=r.settings.contextMenu.length;l<b;l++)y[r.settings.contextMenu[l]]=p[r.settings.contextMenu[l]];else y=p;n.contextMenu({selector:t.attr("id")?"#"+t.attr("id"):"."+t[0].className.replace(/[\s]+/g," ."),trigger:"right",callback:k,items:y})}}function a(t,i){var u,r;this.$container=t,u=this.$container[0],i.bg&&(this.bg=document.createElement("div"),this.bg.className="htBorderBg "+i.className,u.insertBefore(this.bg,u.getElementsByTagName("table")[0])),this.main=document.createElement("div"),this.main.style.position="absolute",this.main.style.top=0,this.main.style.left=0,this.main.innerHTML=new Array(5).join('<div class="htBorder '+i.className+'"></div>'),this.disappear(),u.appendChild(this.main),r=this.main.childNodes,this.top=r[0],this.left=r[1],this.bottom=r[2],this.right=r[3],this.borderWidth=n(this.left).width()}function w(t){var r,i;this.$container=t,r=this.$container[0],this.handle=document.createElement("div"),this.handle.className="htFillHandle",this.disappear(),r.appendChild(this.handle),i=this,n(this.handle).mousedown(function(){i.isDragged=1})}var r,e,u,f,y,o,h,s,c,p=this,l;r={settings:i,isMouseOverTable:!1,isMouseDown:!1,isCellEdited:!1,selStart:null,selEnd:null,editProxy:!1,table:null,isPopulated:null,rowCount:0,colCount:0,scrollable:null,hasLegend:null,lastAutoComplete:null},l="",e={data:[],createRow:function(n){for(var i=[],t=0;t<r.colCount;t++)i.push("");!n||n.row>=r.rowCount?e.data.push(i):e.data.splice(n.row,0,i)},createCol:function(n){var t=0;if(!n||n.col>=r.colCount)for(;t<r.rowCount;t++)e.data[t].push("");else for(;t<r.rowCount;t++)e.data[t].splice(n.col,0,"")},removeRow:function(n,t){n&&n.row!==r.rowCount-1?e.data.splice(n.row,t.row-n.row+1):e.data.pop()},removeCol:function(n,t){var i=0,u;if(n&&n.col!==r.colCount-1)for(u=t.col-n.col+1;i<r.rowCount;i++)e.data[i].splice(n.col,u);else for(;i<r.rowCount;i++)e.data[i].pop()},get:function(n,t){if(e.data[n])return e.data[n][t]},set:function(n,t,i){e.data[n][t]=i},clear:function(){for(var n,t=0;t<r.rowCount;t++)for(n=0;n<r.colCount;n++)e.data[t][n]=""},getAll:function(){return e.data},getRange:function(n,t){var r,f,i,s,o=[],u;for(f=Math.max(n.row,t.row),s=Math.max(n.col,t.col),r=Math.min(n.row,t.row);r<=f;r++){for(u=[],i=Math.min(n.col,t.col);i<=s;i++)u.push(e.data[r][i]);o.push(u)}return o},getText:function(n,t){for(var f=e.getRange(n,t),u="",r,o,i=0,s=f.length;i<s;i++){for(r=0,o=f[i].length;r<o;r++)r>0&&(u+="\t"),u+=f[i][r];u+="\n"}return u}},u={alter:function(t,i,f){var c,h,l,o,v,s,a;r.settings.onChange&&(c=n.extend(!0,[],e.getAll()));switch(t){case"insert_row":u.createRow(i),e.createRow(i);break;case"insert_col":u.createCol(i),e.createCol(i);break;case"remove_row":u.removeRow(i,f),e.removeRow(i,f),u.keepEmptyRows();break;case"remove_col":u.removeCol(i,f),e.removeCol(i,f),u.keepEmptyRows()}if(r.settings.onChange){for(l=[],h=e.getAll(),o=0,v=h.length;o<v;o++)for(s=0,a=h[o].length;s<a;s++)l.push([o,s,c[o]?c[o][s]:null,h[o][s]]);r.settings.onChange(l)}},createRow:function(n){for(var f,t=document.createElement("tr"),i=0;i<r.colCount;i++)t.appendChild(document.createElement("td"));!n||n.row>=r.rowCount?r.tableBody.appendChild(t):(f=u.getCellAtCoords(n).parentNode,r.tableBody.insertBefore(t,f)),r.rowCount++},createCol:function(n){var i=r.tableBody.childNodes,t;if(!n||n.col>=r.colCount)for(t=0;t<r.rowCount;t++)i[t].appendChild(document.createElement("td"));else for(t=0;t<r.rowCount;t++)i[t].insertBefore(document.createElement("td"),u.getCellAtCoords({row:t,col:n.col}));r.colCount++},removeRow:function(t,i){if(t&&t.row!==r.rowCount-1)for(var u=i.row;u>=t.row;u--)n(r.tableBody.childNodes[u]).remove(),r.rowCount--;else n(r.tableBody.childNodes[r.rowCount-1]).remove(),r.rowCount--},removeCol:function(t,i){var e=r.tableBody.childNodes,u=0,f;if(t&&t.col!==r.colCount-1)for(;u<r.rowCount;u++){for(f=i.col;f>=t.col;f--)n(e[u].childNodes[f]).remove();r.colCount--}else{for(;u<r.rowCount;u++)n(e[u].childNodes[r.colCount-1]).remove();r.colCount--}},keepEmptyRows:function(){var o,i,s,y,l=0,a=0,v,c=!1,h=!1,t=n(r.tableBody);o=e.getAll(),v=o.length;n:for(i=v-1;i>=0;i--){for(s=0,y=o[i].length;s<y;s++)if(o[i][s]!=="")break n;l++}if(r.rowCount<r.settings.rows||l<r.settings.minSpareRows)for(;r.rowCount<r.settings.rows||l<r.settings.minSpareRows;l++)u.createRow(),e.createRow(),c=!0;if(r.settings.minHeight&&t.height()>0&&t.height()<=r.settings.minHeight)while(t.height()<=r.settings.minHeight)u.createRow(),e.createRow(),c=!0;if(o=e.getAll(),v=o.length,v>0){y=o[0].length;n:for(s=y-1;s>=0;s--){for(i=0;i<v;i++)if(o[i][s]!=="")break n;a++}}if(r.colCount<r.settings.cols||a<r.settings.minSpareCols)for(;r.colCount<r.settings.cols||a<r.settings.minSpareCols;a++)u.createCol(),e.createCol(),h=!0;if(r.settings.minWidth&&t.width()>0&&t.width()<=r.settings.minWidth)while(t.width()<=r.settings.minWidth)u.createCol(),e.createCol(),h=!0;if(!c)for(;r.settings.rows&&r.rowCount>r.settings.rows&&r.settings.minSpareRows&&l>r.settings.minSpareRows&&(!r.settings.minHeight||t.height()-t.find("tr:last").height()-4>r.settings.minHeight);l--)u.removeRow(),e.removeRow(),c=!0;if(c&&r.selStart&&(r.selStart.row>r.rowCount-1?(r.selStart.row=r.rowCount-1,r.selEnd.row>r.selStart.row&&(r.selEnd.row=r.selStart.row)):r.selEnd.row>r.rowCount-1&&(r.selEnd.row=r.rowCount-1,r.selStart.row>r.selEnd.row&&(r.selStart.row=r.selEnd.row))),!h)for(;r.settings.cols&&r.colCount>r.settings.cols&&r.settings.minSpareCols&&a>r.settings.minSpareCols&&r.settings.minWidth&&t.width()-t.find("tr:last").find("td:last").width()-4>r.settings.minWidth;a--)u.removeCol(),e.removeCol(),h=!0;return h&&r.selStart&&(r.selStart.col>r.colCount-1?(r.selStart.col=r.colCount-1,r.selEnd.col>r.selStart.col&&(r.selEnd.col=r.selStart.col)):r.selEnd.col>r.colCount-1&&(r.selEnd.col=r.colCount-1,r.selStart.col>r.selEnd.col&&(r.selStart.col=r.selEnd.col))),(c||h)&&(u.createLegend(),f.refreshBorders()),c||h},createLegend:function(){var i,f,o,s,t,e;if(u.resetLegend(),r.settings.legend)for(i=0;i<r.rowCount;i++)for(f=0;f<r.colCount;f++)for(o=0,s=r.settings.legend.length;o<s;o++)t=r.settings.legend[o],t.match(i,f,p.getData)&&(r.hasLegend=!0,e=n(u.getCellAtCoords({row:i,col:f})),typeof t.style!="undefined"&&e.css(t.style),typeof t.readOnly!="undefined"&&e.data("readOnly",t.readOnly),typeof t.title!="undefined"&&e.attr("title",t.title))},resetLegend:function(){var i,t,f;if(r.hasLegend)for(i=u.getAllCells(),t=0,f=i.length;t<f;t++)n(i[t]).removeAttr("style").removeAttr("title").removeData("readOnly")},isCellWriteable:function(n){return r.isPopulated&&n.data("readOnly")?!1:!0},populateFromArray:function(t,i,o){var l,y,a,p,v,b,s=[],c={},k,h,w;if(y=i.length,y===0)return!1;for(c.row=t.row,c.col=t.col,l=0;l<y;l++){if(o&&c.row>o.row)break;for(c.col=t.col,p=i[l]?i[l].length:0,a=0;a<p;a++){if(o&&c.col>o.col)break;v=u.getCellAtCoords(c),u.isCellWriteable(n(v))&&s.push([c.row,c.col,e.get(c.row,c.col),i[l][a]]),c.col++,o&&a===p-1&&(a=-1)}c.row++,o&&l===y-1&&(l=-1)}if(r.settings.onBeforeChange&&s.length&&(k=r.settings.onBeforeChange(s),k===!1))return u.getCellAtCoords(t);for(h=0,w=s.length;h<w;h++)if((!o||!(s[h][0]>o.row)&&!(s[h][1]>o.col))&&s[h][3]!==!1){while(s[h][0]>r.rowCount-1)u.createRow(),e.createRow();while(s[h][1]>r.colCount-1)u.createCol(),e.createCol();if(v=u.getCellAtCoords({row:s[h][0],col:s[h][1]}),u.isCellWriteable(n(v))){switch(typeof s[h][3]){case"string":break;case"number":s[h][3]+="";break;default:s[h][3]=""}v.innerHTML=s[h][3].replace(/\n/g,"<br/>"),e.set(s[h][0],s[h][1],s[h][3]),b=v}}if(r.settings.onChange&&s.length)r.settings.onChange(s);return setTimeout(function(){var n=u.keepEmptyRows();n||(u.createLegend(),f.refreshBorders())},100),b||u.getCellAtCoords(t)},clear:function(){var t=u.getAllCells();n(t).empty()},getCellCoords:function(n){return{row:n.parentNode.rowIndex,col:n.cellIndex}},getCellAtCoords:function(n){if(n.row<0||n.col<0)return null;var t=r.tableBody.childNodes[n.row];return t?t.childNodes[n.col]:null},getCornerCoords:function(t){function i(t,i,r){function u(n){return n[r]}return Array.prototype.map?t.apply(Math,i.map(u)):t.apply(Math,n.map(i,u))}return{TL:{row:i(Math.min,t,"row"),col:i(Math.min,t,"col")},BR:{row:i(Math.max,t,"row"),col:i(Math.max,t,"col")}}},getCellsAtCoords:function(n,t){for(var f=u.getCornerCoords([n,t]),i,e=[],r=f.TL.row;r<=f.BR.row;r++)for(i=f.TL.col;i<=f.BR.col;i++)e.push(u.getCellAtCoords({row:r,col:i}));return e},getAllCells:function(){var e=[],f,t,i,n,u;if(f=r.tableBody.childNodes,i=r.rowCount,i>0)for(u=r.colCount,t=0;t<i;t++)for(n=0;n<u;n++)e.push(f[t].childNodes[n]);return e}},f={setRangeStart:function(n){f.deselect(),r.selStart=u.getCellCoords(n),f.setRangeEnd(n)},setRangeEnd:function(n){var t=u.getCellCoords(n);f.end(t),r.settings.multiSelect||(r.selStart=t),f.refreshBorders(),h.scrollViewport(n)},refreshBorders:function(){f.isSelected()&&(r.fillHandle&&s.showHandle(),r.currentBorder.appear([r.selStart]),h.on(),o.prepare())},start:function(n){return n&&(r.selStart=n),r.selStart},end:function(n){return n&&(r.selEnd=n),r.selEnd},isMultiple:function(){return!(r.selEnd.col===r.selStart.col&&r.selEnd.row===r.selStart.row)},transformStart:function(n,t){var i=u.getCellAtCoords({row:r.selStart.row+n,col:r.selStart.col+t});i?f.setRangeStart(i):f.setRangeStart(u.getCellAtCoords(r.selStart))},transformEnd:function(n,t){var i=u.getCellAtCoords({row:r.selEnd.row+n,col:r.selEnd.col+t});i&&f.setRangeEnd(i)},isSelected:function(){var n=f.end();return!n||typeof n.row=="undefined"?!1:!0},inInSelection:function(n){if(!f.isSelected())return!1;var t=u.getCornerCoords([r.selStart,r.selEnd]);return t.TL.row<=n.row&&t.BR.row>=n.row&&t.TL.col<=n.col&&t.BR.col>=n.col},deselect:function(){f.isSelected()&&(r.isCellEdited&&o.finishEditing(),h.off(),r.currentBorder.disappear(),r.fillHandle&&s.hideHandle(),f.end(!1))},selectAll:function(){if(r.settings.multiSelect){var n=u.getAllCells();n.length&&(f.setRangeStart(n[0]),f.setRangeEnd(n[n.length-1]))}},empty:function(){if(f.isSelected()){var o,i,l,c=[],t,h,s;for(o=u.getCellsAtCoords(r.selStart,f.end()),i=0,l=o.length;i<l;i++)t=u.getCellCoords(o[i]),h=e.get(t.row,t.col),s=n(o[i]),h!==""&&u.isCellWriteable(s)&&(s.empty(),e.set(t.row,t.col,""),c.push([t.row,t.col,h,""]));if(r.settings.onChange&&c.length)r.settings.onChange(c);u.keepEmptyRows(),f.refreshBorders()}}},h={init:function(){r.selectionBorder=new a(t,{className:"selection",bg:!0})},on:function(){if(!f.isSelected())return!1;f.isMultiple()?r.selectionBorder.appear([r.selStart,f.end()]):r.selectionBorder.disappear()},off:function(){if(!f.isSelected())return!1;r.selectionBorder.disappear()},scrollViewport:function(t){var o,s;if(!f.isSelected())return!1;var h=n(t),y=h.offset(),l=r.scrollable.scrollLeft(),c=r.scrollable.scrollTop(),a=r.scrollable.outerWidth()-24,v=r.scrollable.outerHeight()-24,e=r.scrollable.offset(),i=y.top,u=y.left;e&&(i+=c-e.top,u+=l-e.left),o=h.outerHeight(),s=h.outerWidth(),l+a<=u+s?setTimeout(function(){r.scrollable.scrollLeft(u+s-a)},1):l>u&&setTimeout(function(){r.scrollable.scrollLeft(u-2)},1),c+v<=i+o?setTimeout(function(){r.scrollable.scrollTop(i+o-v)},1):c>i&&setTimeout(function(){r.scrollable.scrollTop(i-2)},1)}},s={init:function(){r.fillHandle=new w(t),r.fillBorder=new a(t,{className:"htFillBorder"});n(r.fillHandle.handle).on("dblclick",s.selectAdjacent)},selectAdjacent:function(){var n,o,t,h,i;if(n=f.isMultiple()?r.selectionBorder.corners:r.currentBorder.corners,r.fillBorder.disappear(),n.TL.col>0){o=e.getAll();n:for(t=n.BR.row+1;t<r.rowCount;t++){for(i=n.TL.col;i<=n.BR.col;i++)if(o[t][i])break n;!o[t][n.TL.col-1]||(h=t)}h&&(s.showBorder(u.getCellAtCoords({row:h,col:n.BR.col})),s.apply())}},apply:function(){var n,t,i,e,o;(r.fillHandle.isDragged=0,n=r.fillBorder.corners,n)&&(r.fillBorder.disappear(),t=f.isMultiple()?r.selectionBorder.corners:r.currentBorder.corners,n.TL.row===t.TL.row&&n.TL.col<t.TL.col?(i=n.TL,e={row:n.BR.row,col:t.TL.col-1}):n.TL.row===t.TL.row&&n.BR.col>t.BR.col?(i={row:n.TL.row,col:t.BR.col+1},e=n.BR):n.TL.row<t.TL.row&&n.TL.col===t.TL.col?(i=n.TL,e={row:t.TL.row-1,col:n.BR.col}):n.BR.row>t.BR.row&&n.TL.col===t.TL.col&&(i={row:t.BR.row+1,col:n.TL.col},e=n.BR),i?(o=y.parsePasteInput(r.editProxy.val()),u.populateFromArray(i,o,e),f.setRangeStart(u.getCellAtCoords(n.TL)),f.setRangeEnd(u.getCellAtCoords(n.BR))):f.refreshBorders())},showHandle:function(){r.fillHandle.appear([r.selStart,r.selEnd])},hideHandle:function(){r.fillHandle.disappear()},showBorder:function(n){var t=u.getCellCoords(n),i=u.getCornerCoords([r.selStart,r.selEnd]);if(r.settings.fillHandle!=="horizontal"&&(i.BR.row<t.row||i.TL.row>t.row))t={row:t.row,col:i.BR.col};else if(r.settings.fillHandle!=="vertical")t={row:i.BR.row,col:t.col};else return;r.fillBorder.appear([r.selStart,r.selEnd,t])}},y={parsePasteInput:function(n){var t,i,r;for(t=n.split("\n"),t[t.length-1]===""&&t.pop(),i=0,r=t.length;i<r;i++)t[i]=t[i].split("\t");return t}},o={init:function(){function h(n){n.stopPropagation()}function c(){o.finishEditing(),setTimeout(function(){f.empty()},100)}function s(){o.finishEditing(),setTimeout(function(){var i=r.editProxy.val().replace(/^[\r\n]*/g,"").replace(/[\r\n]*$/g,""),t=y.parsePasteInput(i),n=u.populateFromArray({row:Math.min(r.selStart.row,r.selEnd.row),col:Math.min(r.selStart.col,r.selEnd.col)},t);f.setRangeEnd(n)},100)}function i(n){var i,t;if(f.isSelected()){if(i=(n.ctrlKey||n.metaKey)&&!n.altKey,n.keyCode>=48&&n.keyCode<=57||n.keyCode>=96&&n.keyCode<=111||n.keyCode>=65&&n.keyCode<=90){i?i&&n.keyCode===65&&f.selectAll():o.beginEditing();return}t=n.shiftKey?f.setRangeEnd:f.setRangeStart;switch(n.keyCode){case 38:if(v())return!0;n.shiftKey?f.transformEnd(-1,0):o.finishEditing(!1,-1,0),n.preventDefault();break;case 39:case 9:r.isCellEdited&&n.keyCode!==9||(n.shiftKey?f.transformEnd(0,1):o.finishEditing(!1,0,1),n.preventDefault());break;case 37:r.isCellEdited||(n.shiftKey?f.transformEnd(0,-1):o.finishEditing(!1,0,-1),n.preventDefault());break;case 8:case 46:r.isCellEdited||(f.empty(n),n.preventDefault());break;case 27:case 113:case 13:case 40:if(r.isCellEdited){if(n.shiftKey||v()&&n.keyCode===40)return!0;(n.keyCode===27||n.keyCode===13||n.keyCode===40)&&(n.keyCode===27?o.finishEditing(!0,0,0):v()||o.finishEditing(!1,1,0),n.preventDefault())}else n.keyCode===113||n.keyCode===13?(o.beginEditing(!0),n.keyCode===13&&n.shiftKey||n.preventDefault()):n.keyCode===40&&(n.shiftKey?f.transformEnd(1,0):f.transformStart(1,0));break;case 36:n.ctrlKey||n.metaKey?t(u.getCellAtCoords({row:0,col:r.selStart.col})):t(u.getCellAtCoords({row:r.selStart.row,col:0}));break;case 35:n.ctrlKey||n.metaKey?t(u.getCellAtCoords({row:r.rowCount-1,col:r.selStart.col})):t(u.getCellAtCoords({row:r.selStart.row,col:r.colCount-1}));break;case 33:t(u.getCellAtCoords({row:0,col:r.selStart.col}));break;case 34:t(u.getCellAtCoords({row:r.rowCount-1,col:r.selStart.col}))}}}function e(){if(v()){var n=r.editProxy.val();n!==l&&n===r.lastAutoComplete&&(r.isCellEdited=!0,o.finishEditing(!1,1,0)),l=n}}r.editProxy=n('<textarea class="handsontableInput">'),r.editProxyHolder=n('<div class="handsontableInputHolder">'),r.editProxyHolder.append(r.editProxy);r.editProxy.on("click",h);r.editProxy.on("cut",c);r.editProxy.on("paste",s);r.editProxy.on("keydown",i);r.editProxy.on("change",e);t.append(r.editProxyHolder)},prepare:function(){var f,i,l;if(r.editProxy.height(r.editProxy.parent().innerHeight()-4),r.editProxy.val(e.getText(r.selStart,r.selEnd)),setTimeout(o.focus,1),r.settings.autoComplete)for(f=r.editProxy.data("typeahead"),f&&(f.source=[]),i=0,l=r.settings.autoComplete.length;i<l;i++)if(r.settings.autoComplete[i].match(r.selStart.row,r.selStart.col,p.getData)){f?(f.source=r.settings.autoComplete[i].source(),f.highlighter=r.settings.autoComplete[i].highlighter||b):r.editProxy.typeahead({source:r.settings.autoComplete[i].source(),updater:function(n){return r.lastAutoComplete=n,n},highlighter:r.settings.autoComplete[i].highlighter||b});break}var v=u.getCellAtCoords(r.selStart),c=n(v).offset(),h=t.offset(),s=c.top-h.top+t.scrollTop()-1,a=c.left-h.left+t.scrollLeft()-1;n.browser.mozilla||(n.browser.msie&&(parseInt(n.browser.version)<8?s-=2:parseInt(n.browser.version)===8&&(s-=1)),s+=1,a+=1),r.editProxyHolder.addClass("hidden"),r.editProxyHolder.css({top:s,left:a,overflow:"hidden",zIndex:1}),r.editProxy.css({width:"1000px",height:"1000px"})},focus:function(){r.editProxy[0].select()},beginEditing:function(t){if(!r.isCellEdited){r.fillHandle&&s.hideHandle();var o=u.getCellAtCoords(r.selStart),i=n(o);(r.isCellEdited=!0,l="",f.isMultiple()&&(h.off(),r.selEnd=r.selStart,h.on()),u.isCellWriteable(i))&&(t?r.editProxy.val(e.get(r.selStart.row,r.selStart.col)):r.editProxy.val(""),r.editProxy.autoResize?r.editProxy.autoResize({maxHeight:200,minHeight:i.outerHeight()-4,minWidth:i.width(),maxWidth:Math.max(168,i.width()),animate:!1,extraSpace:0}):r.editProxy.css({width:i.width()*1.5,height:i.height()}),r.editProxyHolder.removeClass("hidden"),r.editProxyHolder.css({overflow:"visible",zIndex:4}),r.settings.autoComplete&&setTimeout(function(){r.editProxy.trigger("keyup")},50))}},finishEditing:function(t,i,o){var c,s;if(r.isCellEdited){r.isCellEdited=!1;var l=u.getCellAtCoords(r.selStart),v=n(l),a=n.trim(r.editProxy.val()),h=e.get(r.selStart.row,r.selStart.col);if(h!==a&&u.isCellWriteable(v)||(t=!0),!t)if(s=[[r.selStart.row,r.selStart.col,h,a]],r.settings.onBeforeChange&&(c=r.settings.onBeforeChange(s)),c!==!1&&s[0][3]!==!1){if(l.innerHTML=s[0][3].replace(/\n/g,"<br/>"),e.set(s[0][0],s[0][1],s[0][3]),r.settings.onChange)r.settings.onChange(s);u.keepEmptyRows()}else t=!0;r.editProxy.css({width:"1000px",height:"1000px"}),r.editProxyHolder.addClass("hidden"),r.editProxyHolder.css({overflow:"hidden"})}typeof i!="undefined"&&typeof o!="undefined"&&(t?f.refreshBorders():f.transformStart(i,o))}},c={onMouseDown:function(n){r.isMouseDown=!0,n.button===2&&f.inInSelection(u.getCellCoords(this))||(n.shiftKey?f.setRangeEnd(this):f.setRangeStart(this))},onMouseOver:function(){r.isMouseDown?f.setRangeEnd(this):r.fillHandle&&r.fillHandle.isDragged&&(r.fillHandle.isDragged++,s.showBorder(this))},onDblClick:function(){r.editProxy[0].focus(),o.beginEditing(!0)}},this.setDataAtCell=function(n,t,i){var r=u.getCellAtCoords({row:n,col:t});r.innerHTML=i.replace(/\n/g,"<br/>"),e.set(n,t,i)},this.loadData=function(n){r.isPopulated=!1,e.clear(),u.clear(),u.populateFromArray({row:0,col:0},n),r.isPopulated=!0},this.getData=function(){return e.getAll()},this.updateSettings=function(n){var t,i;for(t in n)n.hasOwnProperty(t)&&(r.settings[t]=n[t]);i=u.keepEmptyRows(),i||(u.createLegend(),f.refreshBorders())},this.clear=function(){f.selectAll(),f.empty()},this.alter=function(n,t,i){typeof i=="undefined"&&(i=t);switch(n){case"insert_row":case"remove_row":u.alter(n,{row:t,col:0},{row:i,col:0});break;case"insert_col":case"remove_col":u.alter(n,{row:0,col:t},{row:0,col:i})}},a.prototype={appear:function(t){var y,o,s,a,l,i,v,r,c,e,f,h;this.corners=u.getCornerCoords(t),y=n(u.getCellAtCoords(this.corners.TL)),o=t.length>1?n(u.getCellAtCoords(this.corners.BR)):y,s=y.offset(),a=t.length>1?o.offset():s,l=this.$container.offset(),v=s.top,e=a.top+o.outerHeight()-v,c=s.left,f=a.left+o.outerWidth()-c,i=v-l.top+this.$container.scrollTop()-1,r=c-l.left+this.$container.scrollLeft()-1,n.browser.mozilla||(n.browser.msie&&parseInt(n.browser.version)<9&&(i-=1),i+=1,r+=1),i<0&&(i=0),r<0&&(r=0),this.bg&&(this.bg.style.top=i+"px",this.bg.style.left=r+"px",this.bg.style.width=f+"px",this.bg.style.height=e+"px",this.bg.style.display="block"),this.top.style.top=i+"px",this.top.style.left=r+"px",this.top.style.width=f+"px",this.left.style.top=i+"px",this.left.style.left=r+"px",this.left.style.height=e+"px",h=Math.floor(this.borderWidth/2),this.bottom.style.top=i+e-h+"px",this.bottom.style.left=r+"px",this.bottom.style.width=f+"px",this.right.style.top=i+"px",this.right.style.left=r+f-h+"px",this.right.style.height=e+1+"px",this.main.style.display="block"},disappear:function(){this.main.style.display="none",this.bg&&(this.bg.style.display="none"),this.corners=null}},w.prototype={appear:function(t){var i,f,r,s,h,e,o,c=u.getCornerCoords(t);i=n(u.getCellAtCoords(c.BR)),f=i.offset(),r=this.$container.offset(),s=f.top-r.top+this.$container.scrollTop()-1,h=f.left-r.left+this.$container.scrollLeft()-1,e=i.outerHeight(),o=i.outerWidth(),this.handle.style.top=s+e-3+"px",this.handle.style.left=h+o-3+"px",this.handle.style.display="block"},disappear:function(){this.handle.style.display="none"}},k(i)}var t={rows:5,cols:5,minSpareRows:0,minSpareCols:0,minHeight:0,minWidth:0,multiSelect:!0,fillHandle:!0};n.fn.handsontable=function(r,u){var f,s,e,o=[];if(typeof r!="string")return u=r,this.each(function(){var f=n(this),e,r;f.data("handsontable")?(r=f.data("handsontable"),r.updateSettings(u)):(e=n.extend({},t),u&&n.extend(e,u),r=new i(f,e),f.data("handsontable",r))});if(e=[],arguments.length>1)for(f=1,s=arguments.length;f<s;f++)e.push(arguments[f]);return this.each(function(){o=n(this).data("handsontable")[r].apply(this,e)}),o}})(jQuery)