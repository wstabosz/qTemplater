(function(n){n.browser.opera&&n(document).keypress(function(t){n.asuggestFocused&&(n.asuggestFocused.focus(),n.asuggestFocused=null,t.preventDefault(),t.stopPropagation())}),n.asuggestKeys={UNKNOWN:0,SHIFT:16,CTRL:17,ALT:18,LEFT:37,UP:38,RIGHT:39,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8,SPACE:32},n.asuggestFocused=null,n.fn.asuggest=function(t,i){return this.each(function(){n.makeSuggest(this,t,i)})},n.fn.asuggest.defaults={delimiters:"\n ",minChunkSize:1,cycleOnTab:!0,autoComplete:!0,endingSymbols:" ",stopSuggestionKeys:[n.asuggestKeys.RETURN,n.asuggestKeys.SPACE],ignoreCase:!1},n.makeSuggest=function(t,i,r){r=n.extend({},n.fn.asuggest.defaults,r);var f=n.asuggestKeys,u=n(t);return u.suggests=i,u.options=r,u.getChunk=function(){for(var u=this.options.delimiters.split(),r=this.val().substr(0,this.getSelection().start),t=-1,f,i,n=0;n<u.length;n++)f=u[n],i=r.lastIndexOf(f),i>t&&(t=i);return t<0?r:r.substr(t+1)},u.getCompletion=function(n){for(var i=this.getChunk(),s=this.getSelection().text,o=this.suggests,e=!1,r=null,t,f=0;f<o.length;f++)if(t=o[f],u.options.ignoreCase&&(t=t.toLowerCase(),i=i.toLowerCase()),t.indexOf(i)===0)if(n)if(i+s===t)e=!0;else{if(e)return t.substr(i.length);r===null&&(r=t)}else return t.substr(i.length);return n&&r?r.substr(i.length):null},u.updateSelection=function(n){if(n){var t=u.getSelection().start,i=t+n.length;u.getSelection().text===""?(u.val().length===t&&u.setCaretPos(t+1e4),u.insertAtCaretPos(n)):u.replaceSelection(n),u.setSelection(t,i)}},u.keydown(function(t){var e,i,r;return t.keyCode===f.TAB&&u.options.cycleOnTab?(e=u.getChunk(),e.length>=u.options.minChunkSize&&u.updateSelection(u.getCompletion(!0)),t.preventDefault(),t.stopPropagation(),u.focus(),n.asuggestFocused=this,!1):u.getSelection().length&&n.inArray(t.keyCode,u.options.stopSuggestionKeys)!==-1?(i=u.getSelection().end+u.options.endingSymbols.length,r=u.getSelection().text+u.options.endingSymbols,u.replaceSelection(r),u.setSelection(i,i),t.preventDefault(),t.stopPropagation(),this.focus(),n.asuggestFocused=this,!1):void 0}),u.keyup(function(n){var r=n.altKey||n.metaKey||n.ctrlKey,i=r||n.shiftKey,t;switch(n.keyCode){case f.UNKNOWN:case f.SHIFT:case f.CTRL:case f.ALT:case f.RETURN:break;case f.TAB:if(!i&&u.options.cycleOnTab)break;case f.ESC:case f.BACKSPACE:case f.DEL:case f.UP:case f.DOWN:case f.LEFT:case f.RIGHT:!i&&u.options.autoComplete&&u.replaceSelection("");break;default:!r&&u.options.autoComplete&&(t=u.getChunk(),t.length>=u.options.minChunkSize&&u.updateSelection(u.getCompletion(!1)))}}),u}})(jQuery)